<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

</head>

<body class="properties-page" style="background:#ffffff;color:#0f172a;">
  {{> __newnav}}

  <div id="properties-app" class="pt-2 pb-5"></div>

  {{> __newfooter}}

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@emotion/react@11.11.4/dist/emotion-react.umd.min.js" crossorigin></script>
  <script src="https://unpkg.com/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js" crossorigin></script>
  <script src="https://unpkg.com/@mui/material@5.15.15/umd/material-ui.development.js" crossorigin></script>

  <script>
    (function () {
      const root = document.getElementById('properties-app');
      const React = window.React;
      const ReactDOM = window.ReactDOM;
      if (!root || !React || !ReactDOM || !window.MaterialUI) return;
      const { useState, useEffect, useMemo } = React;

      const listings = Array.isArray({{{json property}}}) ? {{{json property}}} : [];

      const {
        ThemeProvider,
        createTheme,
        CssBaseline,
        Box,
        Container,
        Typography,
        Stack,
        TextField,
        FormControl,
        InputLabel,
        Select,
        MenuItem,
        Switch,
        Grid,
        Card,
        CardContent,
        CardActions,
        Chip,
        Button,
        Divider,
        Alert,
        IconButton
      } = window.MaterialUI;

      const theme = createTheme({
        palette: {
          mode: 'light',
          primary: { main: '#0f172a' },
          secondary: { main: '#64748b' },
          background: { default: '#ffffff', paper: '#ffffff' },
          text: { primary: '#0f172a', secondary: '#64748b' }
        },
        shape: { borderRadius: 16 },
        typography: {
          fontFamily: 'Poppins, "Segoe UI", sans-serif'
        }
      });

      const cardShadow = () => ({ boxShadow: '0 18px 32px rgba(15,23,42,0.06)' });

      const formatNumber = (value) => {
        if (value === null || value === undefined || value === '') return '';
        const num = Number(value);
        if (Number.isNaN(num)) return String(value);
        return num.toLocaleString('en-US');
      };

      const filterFieldSx = {
        backgroundColor: '#eef3ff',
        borderRadius: '999px',
        '& .MuiOutlinedInput-root': {
          borderRadius: '999px',
          backgroundColor: '#ffffff',
          transition: 'all .2s ease',
          '& fieldset': { borderColor: 'transparent' },
          '&:hover fieldset': { borderColor: 'transparent', boxShadow: '0 0 0 2px rgba(33,85,205,0.15)' },
          '&.Mui-focused fieldset': {
            borderColor: 'transparent',
            boxShadow: '0 0 0 2px rgba(33,85,205,0.25)'
          }
        },
        '& .MuiInputBase-input': { py: 1.15 }
      };

      const safeValue = (val) => {
        if (val === null || val === undefined) return '';
        const str = String(val).trim();
        if (!str) return '';
        const lower = str.toLowerCase();
        if (lower === 'null' || lower === 'undefined') return '';
        return str;
      };

      const hasMeaningfulValue = (val) => safeValue(val) !== '';

      const normalizePhotoPath = (raw) => {
        const candidate = safeValue(raw);
        if (!candidate) return '';
        if (/^https?:\/\//i.test(candidate)) return candidate;
        const cleaned = candidate.replace(/^\/+/, '').replace(/\\/g, '/');
        return cleaned ? '/' + cleaned : '';
      };

      const extractPhotos = (item) => {
        const photos = [];
        const seen = new Set();
        const addPhoto = (raw) => {
          const normalized = normalizePhotoPath(raw);
          if (!normalized || seen.has(normalized)) return;
          seen.add(normalized);
          photos.push(normalized);
        };

        const fileField = safeValue(item && item.PhotoFile);
        if (fileField) {
          fileField.split(',').map((p) => safeValue(p)).filter(Boolean).forEach(addPhoto);
        }

        const urlField = safeValue(item && item.PhotoURL);
        if (urlField) addPhoto(urlField);

        if (!photos.length) photos.push('/public/images/bg_1.jpg');
        return photos;
      };

      const PhotoCarousel = ({ photos, alt }) => {
        const fallbackSrc = '/public/images/bg_1.jpg';
        const images = Array.isArray(photos) && photos.length ? photos : [fallbackSrc];
        const [active, setActive] = useState(0);

        useEffect(() => {
          setActive(0);
        }, [images]);

        const go = (delta) => {
          setActive((prev) => (prev + delta + images.length) % images.length);
        };

        const showNav = images.length > 1;

        return React.createElement(
          Box,
          {
            sx: {
              position: 'relative',
              borderTopLeftRadius: 16,
              borderTopRightRadius: 16,
              overflow: 'hidden',
              background: '#f8fafc'
            }
          },
          React.createElement('img', {
            src: images[active],
            alt: alt || 'Property image',
            onError: (event) => {
              if (!event || !event.target) return;
              event.target.onerror = null;
              event.target.src = fallbackSrc;
            },
            style: { width: '100%', height: 220, objectFit: 'cover', display: 'block' }
          }),
          showNav
            ? React.createElement(
                React.Fragment,
                null,
                React.createElement(
                  IconButton,
                  {
                    size: 'small',
                    onClick: (e) => {
                      e.stopPropagation();
                      go(-1);
                    },
                    sx: {
                      position: 'absolute',
                      top: '50%',
                      left: 12,
                      transform: 'translateY(-50%)',
                      bgcolor: 'rgba(15,23,42,0.65)',
                      color: '#fff',
                      '&:hover': { bgcolor: 'rgba(15,23,42,0.85)' }
                    }
                  },
                  '‹'
                ),
                React.createElement(
                  IconButton,
                  {
                    size: 'small',
                    onClick: (e) => {
                      e.stopPropagation();
                      go(1);
                    },
                    sx: {
                      position: 'absolute',
                      top: '50%',
                      right: 12,
                      transform: 'translateY(-50%)',
                      bgcolor: 'rgba(15,23,42,0.65)',
                      color: '#fff',
                      '&:hover': { bgcolor: 'rgba(15,23,42,0.85)' }
                    }
                  },
                  '›'
                ),
                React.createElement(
                  Box,
                  {
                    sx: {
                      position: 'absolute',
                      bottom: 12,
                      left: '50%',
                      transform: 'translateX(-50%)',
                      bgcolor: 'rgba(15,23,42,0.75)',
                      color: '#fff',
                      px: 1.5,
                      py: 0.25,
                      borderRadius: 999,
                      fontSize: 12,
                      fontWeight: 600
                    }
                  },
                  `${active + 1} / ${images.length}`
                )
              )
            : null
        );
      };

      const getPriceRange = (price) => {
        if (price <= 100000) return '$0 - $100k';
        if (price <= 300000) return '$100k - $300k';
        return '$300k+';
      };

      const PropertyCard = ({ item }) => {
        const photos = useMemo(() => extractPhotos(item), [item.PhotoFile, item.PhotoURL]);
        const contactHref = 'mailto:info@nickhousebuyer.com?subject=' + encodeURIComponent(`Listing ${item.listingId || item.Title || 'Inquiry'}`);
        return React.createElement(Card, {
          sx: {
            height: '100%',
            display: 'flex',
            flexDirection: 'column',
            border: '1px solid rgba(148,163,184,0.25)',
            background: '#fff',
            ...cardShadow()
          }
        },
          React.createElement(PhotoCarousel, { photos, alt: item.Title || 'Property image' }),
          React.createElement(CardContent, { sx: { flexGrow: 1 } },
            React.createElement(Typography, { variant: 'h6', sx: { fontWeight: 600, color: '#0f172a', mb: 0.5 } }, item.Title || 'Untitled'),
            React.createElement(Typography, { variant: 'body2', sx: { color: 'text.secondary', mb: 1 } }, item.PropertyAddress || 'Address upon request'),
            React.createElement(Stack, { direction: 'row', spacing: 1, sx: { mb: 1, alignItems: 'baseline', justifyContent: 'space-between', flexWrap: 'wrap', gap: 1 } },
              React.createElement(Typography, { variant: 'subtitle1', sx: { color: '#0f172a', fontWeight: 600 } }, item.AskingPrice ? `$${Number(item.AskingPrice).toLocaleString()}` : 'Contact'),
              hasMeaningfulValue(item.ARV) ? React.createElement(Typography, { variant: 'body2', sx: { color: 'text.secondary', fontWeight: 600 } }, `ARV: $${formatNumber(item.ARV)}`) : null
            ),
            React.createElement(Stack, { direction: 'row', spacing: 1, sx: { mb: 1, flexWrap: 'wrap' } },
              React.createElement(Chip, { label: `${item.Bedrooms || 0} bd`, size: 'small', variant: 'outlined', sx: { borderColor: 'rgba(15,23,42,0.1)' } }),
              React.createElement(Chip, { label: `${item.Bathrooms || 0} ba`, size: 'small', variant: 'outlined', sx: { borderColor: 'rgba(15,23,42,0.1)' } }),
              item.SquareFootage ? React.createElement(Chip, { label: `${formatNumber(item.SquareFootage)} sqft`, size: 'small', variant: 'outlined', sx: { borderColor: 'rgba(15,23,42,0.1)' } }) : null,
              item.PropertyType ? React.createElement(Chip, { label: item.PropertyType, size: 'small', color: 'secondary', variant: 'outlined' }) : null
            ),
            item.Description ? React.createElement(Typography, { variant: 'body2', color: 'text.secondary' }, item.Description.slice(0, 120) + (item.Description.length > 120 ? '...' : '')) : null
          ),
          React.createElement(CardActions, {
            sx: {
              px: 3,
              pb: 3,
              justifyContent: 'space-between',
            alignItems: 'center',
            gap: 1,
            flexWrap: 'wrap'
          }
        },
          React.createElement(Button, { variant: 'outlined', color: 'primary', size: 'small', href: `/property/${item.listingId}` }, 'View'),
          React.createElement(Button, {
            variant: 'contained',
            color: 'primary',
            size: 'small',
            href: contactHref,
            sx: {
              background: 'linear-gradient(135deg,#0b1f44,#0f60ff)',
              color: '#fff',
              fontWeight: 700,
              boxShadow: '0 10px 25px rgba(15,23,42,0.18)',
              '&:hover': { background: 'linear-gradient(135deg,#0b1f44,#0c52d4)' }
            }
          }, 'Book a Call')
          )
        );
      };

      const useQueryParams = () => {
        const searchParams = new URLSearchParams(window.location.search);
        return { q: searchParams.get('q') || '', beds: searchParams.get('beds') || '', baths: searchParams.get('baths') || '', priceRange: searchParams.get('priceRange') || '', proOnly: ['true', 'on', '1'].includes((searchParams.get('proOnly') || '').toLowerCase()) };
      };

      function PropertiesApp() {
        const initialFilters = useQueryParams();
        const [filters, setFilters] = React.useState(initialFilters);

        const handleChange = (field) => (event) => {
          const value = event?.target?.type === 'checkbox' ? event.target.checked : event.target.value;
          setFilters((prev) => ({ ...prev, [field]: value }));
        };

        const filteredListings = React.useMemo(() => {
          return listings.filter((item) => {
            const price = Number(item.AskingPrice) || 0;
            const haystack = [item.Title, item.PropertyAddress, item.Description].join(' ').toLowerCase();
            if (filters.q && !haystack.includes(filters.q.toLowerCase())) return false;
            if (filters.beds) {
              const bedsMin = parseInt(filters.beds.replace(/\D/g, ''), 10);
              if (!isNaN(bedsMin) && Number(item.Bedrooms || 0) < bedsMin) return false;
            }
            if (filters.baths) {
              const bathsMin = parseInt(filters.baths.replace(/\D/g, ''), 10);
              if (!isNaN(bathsMin) && Number(item.Bathrooms || 0) < bathsMin) return false;
            }
            if (filters.priceRange && filters.priceRange !== getPriceRange(price)) return false;
            if (filters.proOnly && !item.IsPro) return false;
            return true;
          });
        }, [filters]);

        const handleSubmit = (event) => {
          event.preventDefault();
          const params = new URLSearchParams();
          if (filters.q) params.set('q', filters.q);
          if (filters.beds) params.set('beds', filters.beds);
          if (filters.baths) params.set('baths', filters.baths);
          if (filters.priceRange) params.set('priceRange', filters.priceRange);
          if (filters.proOnly) params.set('proOnly', 'true');
          const newUrl = `${window.location.pathname}?${params.toString()}`;
          window.history.replaceState(null, '', newUrl);
        };

        return React.createElement(ThemeProvider, { theme },
          React.createElement(React.Fragment, null,
            React.createElement(CssBaseline, null),
            React.createElement(Box, {
              sx: {
                backgroundImage: 'linear-gradient(135deg, #e3efff, #c9dbff)',
                color: '#0b1f44',
                py: 7,
                pb: 12,
                textAlign: 'center',
                position: 'relative',
                overflow: 'hidden'
              }
            },
              React.createElement(Container, { maxWidth: 'lg' },
                React.createElement(Stack, { spacing: 2, alignItems: 'center' },
                  React.createElement(Typography, { variant: 'overline', sx: { letterSpacing: 6 } }, 'Nick House Buyer Vault'),
                  React.createElement(Typography, { variant: 'h3', sx: { fontWeight: 800, color: '#0d47a1' } }, 'Blue-Chip Property Inventory'),
                  React.createElement(Typography, { variant: 'body1', sx: { maxWidth: 820, color: 'rgba(11,31,68,0.75)' } }, 'Clean, trustworthy data for investors. Filter quickly, review the numbers, and lock in opportunities.')
                )
              )
            ),
            React.createElement(Container, {
              maxWidth: 'lg',
              sx: {
                mt: { xs: 2, md: 3 },
                mb: 4,
                position: 'relative',
                zIndex: 2
              }
            },
              React.createElement(Box, {
                sx: {
                  borderRadius: '999px',
                  px: { xs: 2, md: 3 },
                  py: { xs: 2, md: 1.2 },
                  background: '#dbe7ff',
                  border: '1px solid rgba(34,69,146,0.18)',
                  boxShadow: '0 35px 60px rgba(9,17,37,0.15)'
                }
              },
                React.createElement('form', { onSubmit: handleSubmit },
                  React.createElement(
                    Box,
                    {
                      sx: {
                        display: 'flex',
                        flexDirection: 'column',
                        gap: 1.1
                      }
                    },
                    React.createElement(
                      Box,
                      {
                        sx: {
                          display: 'grid',
                          gridTemplateColumns: {
                            xs: '1fr',
                            sm: 'repeat(2, minmax(0, 1fr))',
                            md: 'repeat(5, minmax(0, 1fr))'
                          },
                          gap: 1
                        }
                      },
                      React.createElement(TextField, {
                        label: 'Search city, address, or keyword',
                        fullWidth: true,
                        value: filters.q,
                        onChange: handleChange('q'),
                        sx: filterFieldSx
                      }),
                      React.createElement(FormControl, { fullWidth: true, sx: filterFieldSx }, React.createElement(InputLabel, null, 'Bedrooms'),
                        React.createElement(Select, { value: filters.beds, label: 'Bedrooms', onChange: handleChange('beds') },
                          React.createElement(MenuItem, { value: '' }, 'Any'),
                          React.createElement(MenuItem, { value: '1+' }, '1+'),
                          React.createElement(MenuItem, { value: '2+' }, '2+'),
                          React.createElement(MenuItem, { value: '3+' }, '3+'),
                          React.createElement(MenuItem, { value: '4+' }, '4+')
                        )
                      ),
                      React.createElement(FormControl, { fullWidth: true, sx: filterFieldSx }, React.createElement(InputLabel, null, 'Bathrooms'),
                        React.createElement(Select, { value: filters.baths, label: 'Bathrooms', onChange: handleChange('baths') },
                          React.createElement(MenuItem, { value: '' }, 'Any'),
                          React.createElement(MenuItem, { value: '1+' }, '1+'),
                          React.createElement(MenuItem, { value: '2+' }, '2+'),
                          React.createElement(MenuItem, { value: '3+' }, '3+')
                        )
                      ),
                      React.createElement(FormControl, { fullWidth: true, sx: filterFieldSx }, React.createElement(InputLabel, null, 'Price'),
                        React.createElement(Select, { value: filters.priceRange, label: 'Price', onChange: handleChange('priceRange') },
                          React.createElement(MenuItem, { value: '' }, 'Any'),
                          React.createElement(MenuItem, { value: '$0 - $100k' }, '$0 - $100k'),
                          React.createElement(MenuItem, { value: '$100k - $300k' }, '$100k - $300k'),
                          React.createElement(MenuItem, { value: '$300k+' }, '$300k+')
                        )
                      ),
                      React.createElement(Button, {
                        type: 'submit',
                        variant: 'contained',
                        color: 'primary',
                        disableElevation: true,
                        sx: {
                          height: '54px',
                          mt: { xs: 1, md: 0 },
                          borderRadius: '999px',
                          fontWeight: 700,
                          letterSpacing: 1,
                          boxShadow: '0 16px 30px rgba(9,20,53,0.35)',
                          background: 'linear-gradient(135deg,#010924,#092a74)',
                          '&:hover': { background: 'linear-gradient(135deg,#04133d,#0b3286)' }
                        }
                      }, 'APPLY FILTERS')
                    )
                  )
                )
              )
            ),
            React.createElement(Container, { maxWidth: 'xl' },
              filteredListings.length === 0
                ? React.createElement(Alert, { severity: 'info', sx: { mt: 4, backgroundColor: '#fff' } }, 'No properties match your filters. Clear filters to view all listings.')
                : React.createElement(Grid, { container: true, spacing: 3 },
                  filteredListings.map((item) =>
                    React.createElement(Grid, { item: true, xs: 12, sm: 6, lg: 4, key: item.listingId || item.Title },
                      React.createElement(PropertyCard, { item })
                    )
                  )
                )
            ),
            React.createElement(Container, { maxWidth: 'lg', sx: { mt: 5 } },
              React.createElement(Divider, { sx: { mb: 3, borderColor: 'rgba(13,71,161,0.15)' } }),
              React.createElement(Typography, { variant: 'body2', color: 'text.secondary', align: 'center' },
                'Need a curated packet or walkthrough? Message us through the contact page—our team responds fast.')
            )
          )
        );
      }

      const app = React.createElement(PropertiesApp);
      if (ReactDOM.createRoot) {
        ReactDOM.createRoot(root).render(app);
      } else {
        ReactDOM.render(app, root);
      }
    })();
  </script>
</body>
