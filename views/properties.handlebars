<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

</head>

<body class="">
	{{> __newnav}}


	<!-- Hero -->
	<section class="hero-wrap hero-wrap-2 ftco-degree-bg js-fullheight"
		style="background-image: url('public/images/bg_1.jpg');">
		<div class="overlay"></div>
		<div class="container">
			<div class="row no-gutters slider-text js-fullheight align-items-end justify-content-center">
				<div class="col-md-9 ftco-animate pb-5 mb-5 text-center">
					<h1 class="mb-3 bread">Available Properties</h1>
					<p class="lead">Curated, premium listings with priority support and exclusive features.</p>
					<p class="breadcrumbs"><span class="mr-2"><a href="/">Home <i
									class="ion-ios-arrow-forward"></i></a></span>
						<span class="mr-2"><a href="/Properties">Properties <i
									class="ion-ios-arrow-forward"></i></a></span>
					</p>
				</div>
			</div>
		</div>
	</section>

	<!-- Filters / Controls -->
	<section class="ftco-section bg-light">
		<div class="container">
			<style>
				/* Fix flaticon default margin and sizing inside property cards */
				.property-card [class^="flaticon-"],
				.property-card [class*=" flaticon-"] {
					font-family: Flaticon !important;
					font-size: 18px !important;
					margin-left: 0 !important;
					/* override flaticon global left margin */
					margin-right: 8px !important;
					display: inline-block;
					vertical-align: middle;
				}
			</style>
			<form class="mb-4" role="search" aria-label="Property filters">
				<div class="row align-items-center">
					<div class="col-md-4 mb-2">
						<input type="search" name="q" class="form-control"
							placeholder="Search by city, address, or keyword" aria-label="Search properties">
					</div>
					<div class="col-md-2 mb-2">
						<select class="form-control" name="beds" aria-label="Bedrooms">
							<option value="">Beds</option>
							<option>1+</option>
							<option>2+</option>
							<option>3+</option>
							<option>4+</option>
						</select>
					</div>
					<div class="col-md-2 mb-2">
						<select class="form-control" name="baths" aria-label="Bathrooms">
							<option value="">Baths</option>
							<option>1+</option>
							<option>2+</option>
							<option>3+</option>
						</select>
					</div>
					<div class="col-md-2 mb-2">
						<select class="form-control" name="priceRange" aria-label="Price range">
							<option value="">Price</option>
							<option>$0 - $100k</option>
							<option>$100k - $300k</option>
							<option>$300k+</option>
						</select>
					</div>
					<div class="col-md-2 text-right mb-2">
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="checkbox" id="proOnly" name="proOnly">
							<label class="form-check-label" for="proOnly">Pro only</label>
						</div>
						<button type="submit" class="btn btn-primary btn-sm ml-2">Filter</button>
					</div>
				</div>
			</form>

			<!-- Properties grid -->
			<div class="row" id="properties-grid">
				{{#each property}}
				<div class="col-lg-4 col-md-6 mb-4">
					<article class="card property-card h-100 shadow-sm" aria-labelledby="title-{{this.listingId}}">
						<div class="card-img-top position-relative"
							style="background-image:url({{this.PhotoFile}}); background-size:cover; background-position:center; height:220px;">
							<!-- Pro badge (assumption: property has IsPro boolean) -->
							{{#if this.IsPro}}
							<span class="badge badge-warning position-absolute" style="top:12px; left:12px;">PRO</span>
							{{/if}}

							<div class="card-actions position-absolute" style="right:12px; top:12px;">
								<a href="/property/{{this.listingId}}" class="btn btn-sm btn-light"
									aria-label="View details for {{this.Title}}">Details</a>
							</div>
						</div>

						<div class="card-body d-flex flex-column">
							<div class="d-flex justify-content-between align-items-start mb-2">
								<h3 id="title-{{this.listingId}}" class="h5 mb-0"><a
										href="/property/{{this.listingId}}">{{this.Title}}</a></h3>
								<div class="text-right text-primary font-weight-bold">${{this.AskingPrice}}</div>
							</div>

							<p class="text-muted small mb-2"><i class="ion-ios-pin"></i> {{this.PropertyAddress}}</p>

							<ul class="list-inline text-muted small mb-3">
								<li class="list-inline-item" title="Bedrooms"><i class="flaticon-bed"></i>
									{{this.Bedrooms}}</li>
								<li class="list-inline-item" title="Bathrooms"><i class="flaticon-bathtub"></i>
									{{this.Bathrooms}}</li>
								<li class="list-inline-item" title="Square footage"><i class="flaticon-floor-plan"></i>
									{{formatSqft this.SquareFootage this.FloorArea}}</li>
							</ul>

							<div class="mt-auto d-flex justify-content-between align-items-center">
								<div class="agent d-flex align-items-center">
									<div class="agent-photo rounded-circle mr-2"
										style="width:36px; height:36px; background-image:url(public/images/person_1.jpg); background-size:cover;">
									</div>
									<div class="small text-muted">Nick Farahmand</div>
								</div>
								<div class="btn-group">
									<button class="btn btn-outline-secondary btn-sm"
										data-listing-id="{{this.listingId}}"
										onclick="openContactModal(this)">Contact</button>
									<a href="/property/{{this.listingId}}" class="btn btn-primary btn-sm">Schedule
										Tour</a>
								</div>
							</div>
						</div>
					</article>
				</div>
				{{/each}}
			</div>

			<!-- Pagination -->
			<div class="row mt-4">
				<div class="col text-center">
					<nav aria-label="Pagination">
						<ul class="pagination justify-content-center">
							<li class="page-item"><a class="page-link" href="#" aria-label="Previous">&laquo;</a></li>
							<li class="page-item active"><span class="page-link">1</span></li>
							<li class="page-item"><a class="page-link" href="#">2</a></li>
							<li class="page-item"><a class="page-link" href="#">3</a></li>
							<li class="page-item"><a class="page-link" href="#" aria-label="Next">&raquo;</a></li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</section>

	<!-- Contact Modal (accessible) -->
	<div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="contactModalLabel">Contact Agent</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<form id="contactForm">
					<div class="modal-body">
						<input type="hidden" name="listingId" id="contactListingId">
						<div class="form-group">
							<label for="contactName">Your name</label>
							<input id="contactName" name="name" class="form-control" required />
						</div>
						<div class="form-group">
							<label for="contactEmail">Email</label>
							<input id="contactEmail" name="email" type="email" class="form-control" required />
						</div>
						<div class="form-group">
							<label for="contactMessage">Message</label>
							<textarea id="contactMessage" name="message" class="form-control"
								rows="3">I'm interested in this property. Please contact me.</textarea>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
						<button type="submit" class="btn btn-primary">Send</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script>
		// Small helper: opens the contact modal and fills the listing id.
		function openContactModal(btn) {
			try {
				var id = btn.getAttribute('data-listing-id') || btn.dataset.listingId;
				var el = document.getElementById('contactListingId');
				if (el) el.value = id || '';
				// if bootstrap modal available
				if (window.jQuery && jQuery('#contactModal').modal) {
					jQuery('#contactModal').modal('show');
				}
			} catch (e) {
				console.error(e);
			}
		}

		// Submit handler — posts to /contact (adjust endpoint as needed).
		(function () {
			if (!window.jQuery) return;
			jQuery(function ($) {
				$('#contactForm').on('submit', function (e) {
					e.preventDefault();
					var $btn = $(this).find('button[type=submit]');
					$btn.prop('disabled', true).text('Sending...');
					// Build payload matching /api/contactus expectations
					var listingId = $('#contactListingId').val() || '(no-id)';
					var payload = {
						FullName: $('#contactName').val(),
						Email: $('#contactEmail').val(),
						subject: 'Inquiry about listing ' + listingId,
						message: $('#contactMessage').val() + '\n\nListing ID: ' + listingId
					};

					$.ajax({
						url: '/api/contactus',
						method: 'POST',
						data: payload,
						dataType: 'json'
					})
						.done(function () {
							$('#contactModal').modal('hide');
							// simple feedback — replace with nicer toast if available
							alert('Message sent — an agent will contact you shortly.');
						})
						.fail(function (xhr) {
							var msg = 'Failed to send message. Please try again later.';
							try {
								var json = xhr && xhr.responseJSON;
								if (json && json.error) msg = json.error;
							} catch (e) {}
							alert(msg);
						})
						.always(function () {
							$btn.prop('disabled', false).text('Send');
						});
				});
			});
		})();
	</script>

	{{> __newfooter}}